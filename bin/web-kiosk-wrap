#!/usr/bin/bash

function main {
  [ -z "${1}" ] && return 1
  local url="${1}"

  read -r BROWSER_DESKTOP_FILE < <(xdg-settings get default-web-browser)
  [ -z "${BROWSER_DESKTOP_FILE}" ] && exit 1

  local rpath="/usr/share/applications/${BROWSER_DESKTOP_FILE}"
  [ -f "${rpath}" ] || rpath="/usr/local/share/applications/${BROWSER_DESKTOP_FILE}"
  [ -f "${rpath}" ] || rpath="${HOME}/.local/share/applications/${BROWSER_DESKTOP_FILE}"
  [ -f "${rpath}" ] || return 1

  read -r BROWSER_EXEC < <(grep -Po '(?<=^Exec=)[^\s]*' "${rpath}")
  [ -z "${BROWSER_EXEC}" ] && exit 1

  exec "${BROWSER_EXEC}" "${argv[@]}" --app="${url}"
}

main "${@}"
